[package]
name = "migration"
version = "0.4.4" # TODO: remove this when https://github.com/googleapis/release-please/issues number 2111 is fixed
# version.workspace = true
authors.workspace = true
description.workspace = true
documentation.workspace = true
publish.workspace = true
edition.workspace = true
rust-version.workspace = true


[dependencies]
async-std = { version = "1.13.2", features = ["attributes", "tokio1"] }
sea-orm-migration = { workspace = true }
entity = { path = "../entity" }
anyhow = "1.0"
clap = { version = "4.5", features = ["derive", "env"] }
tracing = { workspace = true }
tracing-subscriber = { version = "0.3", features = ["env-filter"] }
tokio = { workspace = true }
# Override workspace sea-orm to include both SQLite and PostgreSQL for migration tool

# Override workspace sea-orm to include SQLite support only for the migration tool,
# which needs to read from legacy SQLite databases during the one-time migration process.
sea-orm = { version = "1.1.19", features = [
  "sqlx-postgres",
  "sqlx-sqlite",
  "runtime-tokio-rustls",
  "macros",
  "with-chrono",
] }

# Optional dependencies for the sqlite_to_postgres migration tool
home = { version = "0.5", optional = true }
semver = { version = "1.0", optional = true }

[features]
# Feature for the migration tool binary
migration-tool = ["home", "semver"]

[lib]
name = "migration"
path = "src/lib.rs"

[[bin]]
name = "sqlite_to_postgres"
path = "src/bin/sqlite_to_postgres.rs"
required-features = ["migration-tool"]
